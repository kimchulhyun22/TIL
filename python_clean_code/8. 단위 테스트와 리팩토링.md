# 8. 단위 테스트와 리팩토링

---

## 디자인 원칙과 단위 테스트

단위 테스트는 다른 코드의 일부분이 유효한지를 검사하는 코드이다. 단위 테스트는 비즈니스 로직이 특정 조건을 보장하는지를 확인하기 위해 여러 시나리오를 검증하는
코드이다.

**단위 테스트의 특징**
- 격리 : 단위 테스트는 다른 외부 에이전트와 완전히 독립적이어야 하며 비즈니스 로직에만 집중해야 한다. 즉, 테스트는 이전 상태에 관계없이 임의의 순서로 실행되어야 한다.

- 성능 : 단위 테스트는 신속하게 실행되어야 한다. 반복적으로 여러번 실행될 수 있도록 설계해야 한다.

- 자체 검증 : 단위 테스트의 실행만으로 결과를 결정할 수 있어야 한다.

### 자동화된 테스트의 다른 형태

단위 테스트는 함수 또는 메서드와 같은 매우 작은 단위를 확인하기 위한 것이다. 단위 테스트는 최대한 자세하게 코드를 검사하는 것이 목적이다. 
클래스를 테스트하려면 단위 테스트가 아니라 단위 테스트의 집합인 테스트 스위트(test suite)를 사용한다. 테스트 스위트를 구성하는 테스트들은 메서드처럼 보다
작은 것을 테스트한다.

**통합 테스트**는
한 번에 여러 컴포넌트를 테스트한다. 종합적으로 예상대로 잘 동작하는지 검증한다. HTTP 요청을 하거나 데이터베이스에 연결하는 등의 작업을 수행하는 것이
바람직하다.

**인수 테스트**는 유스 케이스를 활용하여 사용자의 관점에서 시스템의 유효성을 검사하는 자동화된 테스트이다.

일반적으로 단위 테스트는 항상 수행되길 원하지만 통합 테스트나 인수 테스트는 그보다 덜 자주 수행되길 바란다. 단위 테스트에서 작은 기능을 많이 테스트하고
단위 테스트에서 확인할 수 없는 부분을 다른 자동화된 테스트에서 커버해야 하기 때문이다. 

### 단위 테스트와 애자일 소프트웨어 개발

최근에는 더 빠르게 피드백을 받을수록 더 쉽게 코드를 수정할 수 있다고 생각하기 때문에 가능한 지속적으로 신속하고 지속적으로 가치를 제공하려 한다. 따라서
소프트웨어를 유연하고 확장 가능하도록 구현하여 효과적으로 대응할 수 있도록 해야 한다. 아무리 변화에 쉽게 대응하는 소프트웨어를 작성했다고 해도 버그가 없다는
것을 증명할 순 없다. 따라서 단위테스트를 통해 코드가 기대한 것처럼 동작한다는 것을 알 수 있다. 

### 단위 테스트와 소프트웨어 디자인

좋은 소프트웨어는 테스트 가능한 소프트웨어이다. 테스트의 용이성은 있으면 좋은 것이 아니라 클린 코드의 핵심 가치이다. 단위 테스트는 기본 코드를 보완하기
위한 것이 아니라 실제 코드의 작성 방식에 영향을 미친다. 메서드가 작아야 테스트하기 용이하기 때문이다. 

### 테스트의 경계 정하기

테스트의 범위는 우리가 작성한 코드의 범위로 한정해야 한다. 그렇지 않고 외부 라이브러리나 모듈과 같은 의존성까지 확인해야 한다면 끝이 없을 것이다. 의존성을
테스트하는 것은 우리의 책임이 아니다. 외부 의존성은 올바른 파라미터를 사용해 호출하면 정상적으로 실행된다는 것만 확인해도 충분하다.

좋은 단위 테스트는 시스템의 경계에는 패치를 적용하여 넘어가고 핵심 기능에 초점을 둔다. 

---



